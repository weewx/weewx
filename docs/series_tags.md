# Tags for series

## Overview
WeeWX Version 4.5 introduces limited support for tags that specifies _series_. The results
can be formatted either as JSON, or as a string. This document describes the syntax.

**NOTE:** This syntax is still experimental and subject to change! 

## Syntax
The tags used to specify a series is very similar to tags used for regular scalars, except they
include the keyword `series`:

```
$period($data_binding=binding_name, $optional_ago=delta).obstype.series[.optional_unit_conversion][.optional_formatting]
```

## Series with no aggregation
Here's an example of asking for a series with the temperature for all records in the day. We will
display it with an HTML `<pre>` tag so that the embedded newlines work.

```
<pre>
$day.outTemp.series
</pre>
```

This would result in something like this:
```
12:00:00 AM, 12:05:00 AM, 43.8°F
12:05:00 AM, 12:10:00 AM, 43.8°F
12:10:00 AM, 12:15:00 AM, 42.7°F
12:15:00 AM, 12:20:00 AM, 41.3°F
          ...
```
The first column is the start time of each point in the series, the second column is the stop time.
From this example, we can see that the data have a 5 minute archive period.

## Series with no aggregation, formatted as JSON
This example is similar to the previous example, except we will return the results as JSON:

```
<pre>
$day.outTemp.series.json()
</pre>
```

This results in:
```
[[1610956800, 1610957100, 43.8], [1610957100, 1610957400, 43.8], [1610957400, 1610957700, 42.7], [1610957700, 1610958000, 41.3], [1610958000, 1610958300, 40.7], [1610958300, 1610958600, 40.5], [1610958600, 1610958900, 41.4], [1610958900, 1610959200, 40.7], [1610959200, 1610959500, 41.1], [1610959500, 1610959800, 42.1], [1610959800, 1610960100, 43.0], [1610960100, 1610960400, 43.3], [1610960400, 1610960700, 43.4], [1610960700, 1610961000, 41.6], [1610961000, 1610961300, 38.2], [1610961300, 1610961600, 37.8], [1610961600, 1610961900, 37.6], [1610961900, 1610962200, 37.6], [1610962200, 1610962500, 37.9], [1610962500, 1610962800, 38.6], [1610962800, 1610963100, 38.9], [1610963100, 1610963400, 38.4], [1610963400, 1610963700, 37.8], [1610963700, 1610964000, 36.6], [1610964000, 1610964300, 36.6], [1610964300, 1610964600, 37.2], [1610964600, 1610964900, 36.6], [1610964900, 1610965200, 35.9], [1610965200, 1610965500, 35.2], [1610965500, 1610965800, 34.8], [1610965800, 1610966100, 34.1], [1610966100, 1610966400, 33.9], [1610966400, 1610966700, 33.9], [1610966700, 1610967000, 33.9], [1610967000, 1610967300, 33.6], [1610967300, 1610967600, 33.6], [1610967600, 1610967900, 33.6], [1610967900, 1610968200, 33.4], [1610968200, 1610968500, 33.0], [1610968500, 1610968800, 33.0], [1610968800, 1610969100, 33.0], [1610969100, 1610969400, 32.7], [1610969400, 1610969700, 32.8], [1610969700, 1610970000, 33.0], [1610970000, 1610970300, 33.0], [1610970300, 1610970600, 32.9], [1610970600, 1610970900, 32.8], [1610970900, 1610971200, 32.6], [1610971200, 1610971500, 32.4], [1610971500, 1610971800, 32.1], [1610971800, 1610972100, 32.3], [1610972100, 1610972400, 32.2], [1610972400, 1610972700, 32.0], [1610972700, 1610973000, 31.9], [1610973000, 1610973300, 32.1], [1610973300, 1610973600, 32.1], [1610973600, 1610973900, 31.7], [1610973900, 1610974200, 32.3], [1610974200, 1610974500, 32.5], [1610974500, 1610974800, 32.6], [1610974800, 1610975100, 32.7], [1610975100, 1610975400, 32.9], [1610975400, 1610975700, 32.6], [1610975700, 1610976000, 32.3], [1610976000, 1610976300, 32.0], [1610976300, 1610976600, 31.7], [1610976600, 1610976900, 31.4], [1610976900, 1610977200, 31.4], [1610977200, 1610977500, 31.2], [1610977500, 1610977800, 31.1], [1610977800, 1610978100, 31.2], [1610978100, 1610978400, 31.2], [1610978400, 1610978700, 31.3], [1610978700, 1610979000, 31.5], [1610979000, 1610979300, 31.6], [1610979300, 1610979600, 32.0], [1610979600, 1610979900, 32.4], [1610979900, 1610980200, 32.8], [1610980200, 1610980500, 33.1], [1610980500, 1610980800, 33.2], [1610980800, 1610981100, 33.3], [1610981100, 1610981400, 33.2], [1610981400, 1610981700, 33.2], [1610981700, 1610982000, 33.1], [1610982000, 1610982300, 33.0], [1610982300, 1610982600, 32.9], [1610982600, 1610982900, 32.8], [1610982900, 1610983200, 32.7], [1610983200, 1610983500, 32.5], [1610983500, 1610983800, 32.6], [1610983800, 1610984100, 32.6], [1610984100, 1610984400, 32.5], [1610984400, 1610984700, 32.6], [1610984700, 1610985000, 32.4], [1610985000, 1610985300, 32.3], [1610985300, 1610985600, 31.7], [1610985600, 1610985900, 31.7], [1610985900, 1610986200, 31.6], [1610986200, 1610986500, 31.4], [1610986500, 1610986800, 31.6], [1610986800, 1610987100, 31.2], [1610987100, 1610987400, 31.1], [1610987400, 1610987700, 31.2], [1610987700, 1610988000, 31.2], [1610988000, 1610988300, 31.0], [1610988300, 1610988600, 31.3], [1610988600, 1610988900, 31.8], [1610988900, 1610989200, 32.1], [1610989200, 1610989500, 32.4], [1610989500, 1610989800, 32.9], [1610989800, 1610990100, 33.5], [1610990100, 1610990400, 34.4], [1610990400, 1610990700, 34.7], [1610990700, 1610991000, 34.7], [1610991000, 1610991300, 34.5], [1610991300, 1610991600, 34.7], [1610991600, 1610991900, 35.0], [1610991900, 1610992200, 35.3], [1610992200, 1610992500, 35.6], [1610992500, 1610992800, 35.8], [1610992800, 1610993100, 36.2], [1610993100, 1610993400, 36.8], [1610993400, 1610993700, 37.5], [1610993700, 1610994000, 38.5], [1610994000, 1610994300, 38.9], [1610994300, 1610994600, 39.2], [1610994600, 1610994900, 39.4], [1610994900, 1610995200, 39.9], [1610995200, 1610995500, 39.6], [1610995500, 1610995800, 39.8], [1610995800, 1610996100, 39.9], [1610996100, 1610996400, 40.1], [1610996400, 1610996700, 40.2], [1610996700, 1610997000, 40.3], [1610997000, 1610997300, 40.6], [1610997300, 1610997600, 40.5], [1610997600, 1610997900, 41.0], [1610997900, 1610998200, 41.1], [1610998200, 1610998500, 41.4], [1610998500, 1610998800, 41.8], [1610998800, 1610999100, 42.2], [1610999100, 1610999400, 42.4], [1610999400, 1610999700, 42.8], [1610999700, 1611000000, 43.0], [1611000000, 1611000300, 43.2], [1611000300, 1611000600, 43.3], [1611000600, 1611000900, 43.3], [1611000900, 1611001200, 44.1], [1611001200, 1611001500, 44.3], [1611001500, 1611001800, 44.7], [1611001800, 1611002100, 45.3], [1611002100, 1611002400, 45.2], [1611002400, 1611002700, 45.2], [1611002700, 1611003000, 45.9], [1611003000, 1611003300, 45.8], [1611003300, 1611003600, 46.3], [1611003600, 1611003900, 47.0], [1611003900, 1611004200, 47.3], [1611004200, 1611004500, 47.2], [1611004500, 1611004800, 47.0], [1611004800, 1611005100, 47.0], [1611005100, 1611005400, 47.6], [1611005400, 1611005700, 47.3], [1611005700, 1611006000, 47.6], [1611006000, 1611006300, 47.8], [1611006300, 1611006600, 47.8], [1611006600, 1611006900, 47.7], [1611006900, 1611007200, 47.9], [1611007200, 1611007500, 48.3], [1611007500, 1611007800, 48.1], [1611007800, 1611008100, 48.1], [1611008100, 1611008400, 48.3], [1611008400, 1611008700, 48.2], [1611008700, 1611009000, 47.9], [1611009000, 1611009300, 47.6], [1611009300, 1611009600, 47.4], [1611009600, 1611009900, 47.1], [1611009900, 1611010200, 47.2], [1611010200, 1611010500, 47.3], [1611010500, 1611010800, 47.2], [1611010800, 1611011100, 47.2], [1611011100, 1611011400, 47.4], [1611011400, 1611011700, 47.5], [1611011700, 1611012000, 47.5], [1611012000, 1611012300, 47.1], [1611012300, 1611012600, 46.8], [1611012600, 1611012900, 46.3], [1611012900, 1611013200, 45.7], [1611013200, 1611013500, 45.8], [1611013500, 1611013800, 45.6], [1611013800, 1611014100, 45.6]]
```
The default is to order by row. If you want it by column:

```
<pre>
$day.outTemp.series.json(order_by='column')
</pre>
```

Results:
```
[[1610956800, 1610957100, 1610957400, 1610957700, 1610958000, 1610958300, 1610958600, 1610958900, 1610959200, 1610959500, 1610959800, 1610960100, 1610960400, 1610960700, 1610961000, 1610961300, 1610961600, 1610961900, 1610962200, 1610962500, 1610962800, 1610963100, 1610963400, 1610963700, 1610964000, 1610964300, 1610964600, 1610964900, 1610965200, 1610965500, 1610965800, 1610966100, 1610966400, 1610966700, 1610967000, 1610967300, 1610967600, 1610967900, 1610968200, 1610968500, 1610968800, 1610969100, 1610969400, 1610969700, 1610970000, 1610970300, 1610970600, 1610970900, 1610971200, 1610971500, 1610971800, 1610972100, 1610972400, 1610972700, 1610973000, 1610973300, 1610973600, 1610973900, 1610974200, 1610974500, 1610974800, 1610975100, 1610975400, 1610975700, 1610976000, 1610976300, 1610976600, 1610976900, 1610977200, 1610977500, 1610977800, 1610978100, 1610978400, 1610978700, 1610979000, 1610979300, 1610979600, 1610979900, 1610980200, 1610980500, 1610980800, 1610981100, 1610981400, 1610981700, 1610982000, 1610982300, 1610982600, 1610982900, 1610983200, 1610983500, 1610983800, 1610984100, 1610984400, 1610984700, 1610985000, 1610985300, 1610985600, 1610985900, 1610986200, 1610986500, 1610986800, 1610987100, 1610987400, 1610987700, 1610988000, 1610988300, 1610988600, 1610988900, 1610989200, 1610989500, 1610989800, 1610990100, 1610990400, 1610990700, 1610991000, 1610991300, 1610991600, 1610991900, 1610992200, 1610992500, 1610992800, 1610993100, 1610993400, 1610993700, 1610994000, 1610994300, 1610994600, 1610994900, 1610995200, 1610995500, 1610995800, 1610996100, 1610996400, 1610996700, 1610997000, 1610997300, 1610997600, 1610997900, 1610998200, 1610998500, 1610998800, 1610999100, 1610999400, 1610999700, 1611000000, 1611000300, 1611000600, 1611000900, 1611001200, 1611001500, 1611001800, 1611002100, 1611002400, 1611002700, 1611003000, 1611003300, 1611003600, 1611003900, 1611004200, 1611004500, 1611004800, 1611005100, 1611005400, 1611005700, 1611006000, 1611006300, 1611006600, 1611006900, 1611007200, 1611007500, 1611007800, 1611008100, 1611008400, 1611008700, 1611009000, 1611009300, 1611009600, 1611009900, 1611010200, 1611010500, 1611010800, 1611011100, 1611011400, 1611011700, 1611012000, 1611012300, 1611012600, 1611012900, 1611013200, 1611013500, 1611013800], [1610957100, 1610957400, 1610957700, 1610958000, 1610958300, 1610958600, 1610958900, 1610959200, 1610959500, 1610959800, 1610960100, 1610960400, 1610960700, 1610961000, 1610961300, 1610961600, 1610961900, 1610962200, 1610962500, 1610962800, 1610963100, 1610963400, 1610963700, 1610964000, 1610964300, 1610964600, 1610964900, 1610965200, 1610965500, 1610965800, 1610966100, 1610966400, 1610966700, 1610967000, 1610967300, 1610967600, 1610967900, 1610968200, 1610968500, 1610968800, 1610969100, 1610969400, 1610969700, 1610970000, 1610970300, 1610970600, 1610970900, 1610971200, 1610971500, 1610971800, 1610972100, 1610972400, 1610972700, 1610973000, 1610973300, 1610973600, 1610973900, 1610974200, 1610974500, 1610974800, 1610975100, 1610975400, 1610975700, 1610976000, 1610976300, 1610976600, 1610976900, 1610977200, 1610977500, 1610977800, 1610978100, 1610978400, 1610978700, 1610979000, 1610979300, 1610979600, 1610979900, 1610980200, 1610980500, 1610980800, 1610981100, 1610981400, 1610981700, 1610982000, 1610982300, 1610982600, 1610982900, 1610983200, 1610983500, 1610983800, 1610984100, 1610984400, 1610984700, 1610985000, 1610985300, 1610985600, 1610985900, 1610986200, 1610986500, 1610986800, 1610987100, 1610987400, 1610987700, 1610988000, 1610988300, 1610988600, 1610988900, 1610989200, 1610989500, 1610989800, 1610990100, 1610990400, 1610990700, 1610991000, 1610991300, 1610991600, 1610991900, 1610992200, 1610992500, 1610992800, 1610993100, 1610993400, 1610993700, 1610994000, 1610994300, 1610994600, 1610994900, 1610995200, 1610995500, 1610995800, 1610996100, 1610996400, 1610996700, 1610997000, 1610997300, 1610997600, 1610997900, 1610998200, 1610998500, 1610998800, 1610999100, 1610999400, 1610999700, 1611000000, 1611000300, 1611000600, 1611000900, 1611001200, 1611001500, 1611001800, 1611002100, 1611002400, 1611002700, 1611003000, 1611003300, 1611003600, 1611003900, 1611004200, 1611004500, 1611004800, 1611005100, 1611005400, 1611005700, 1611006000, 1611006300, 1611006600, 1611006900, 1611007200, 1611007500, 1611007800, 1611008100, 1611008400, 1611008700, 1611009000, 1611009300, 1611009600, 1611009900, 1611010200, 1611010500, 1611010800, 1611011100, 1611011400, 1611011700, 1611012000, 1611012300, 1611012600, 1611012900, 1611013200, 1611013500, 1611013800, 1611014100], [43.8, 43.8, 42.7, 41.3, 40.7, 40.5, 41.4, 40.7, 41.1, 42.1, 43.0, 43.3, 43.4, 41.6, 38.2, 37.8, 37.6, 37.6, 37.9, 38.6, 38.9, 38.4, 37.8, 36.6, 36.6, 37.2, 36.6, 35.9, 35.2, 34.8, 34.1, 33.9, 33.9, 33.9, 33.6, 33.6, 33.6, 33.4, 33.0, 33.0, 33.0, 32.7, 32.8, 33.0, 33.0, 32.9, 32.8, 32.6, 32.4, 32.1, 32.3, 32.2, 32.0, 31.9, 32.1, 32.1, 31.7, 32.3, 32.5, 32.6, 32.7, 32.9, 32.6, 32.3, 32.0, 31.7, 31.4, 31.4, 31.2, 31.1, 31.2, 31.2, 31.3, 31.5, 31.6, 32.0, 32.4, 32.8, 33.1, 33.2, 33.3, 33.2, 33.2, 33.1, 33.0, 32.9, 32.8, 32.7, 32.5, 32.6, 32.6, 32.5, 32.6, 32.4, 32.3, 31.7, 31.7, 31.6, 31.4, 31.6, 31.2, 31.1, 31.2, 31.2, 31.0, 31.3, 31.8, 32.1, 32.4, 32.9, 33.5, 34.4, 34.7, 34.7, 34.5, 34.7, 35.0, 35.3, 35.6, 35.8, 36.2, 36.8, 37.5, 38.5, 38.9, 39.2, 39.4, 39.9, 39.6, 39.8, 39.9, 40.1, 40.2, 40.3, 40.6, 40.5, 41.0, 41.1, 41.4, 41.8, 42.2, 42.4, 42.8, 43.0, 43.2, 43.3, 43.3, 44.1, 44.3, 44.7, 45.3, 45.2, 45.2, 45.9, 45.8, 46.3, 47.0, 47.3, 47.2, 47.0, 47.0, 47.6, 47.3, 47.6, 47.8, 47.8, 47.7, 47.9, 48.3, 48.1, 48.1, 48.3, 48.2, 47.9, 47.6, 47.4, 47.1, 47.2, 47.3, 47.2, 47.2, 47.4, 47.5, 47.5, 47.1, 46.8, 46.3, 45.7, 45.8, 45.6, 45.6]]
```

## Series with aggregation
Suppose you would like the daily max temperatures for the month. This can be specified as

```
<pre>
$month.outTemp.series(aggregation_type='max', aggregation_interval=86400)
</pre>
```

where `86400` is the number of seconds in the day. As an alternative, you can use the string `day`:

```
<pre>
$month.outTemp.series(aggregation_type='max', aggregation_interval='day')
</pre>
```

Either way, the results would be:

```
01/01/2021 12:00:00 AM, 01/02/2021 12:00:00 AM, 45.6°F
01/02/2021 12:00:00 AM, 01/03/2021 12:00:00 AM, 46.2°F
01/03/2021 12:00:00 AM, 01/04/2021 12:00:00 AM, 49.5°F
  ...
```
Again, the first column is the start of the day, the second column the end of the day, the
final column the maximum temperature for the day.

## Series with aggregation formatted as JSON
The above can be formatted as JSON:
```
<pre>
$month.outTemp.series(aggregation_type='max', aggregation_interval='day').json
</pre>
```
with results:
```
[[1609488000, 1609574400, 45.6], [1609574400, 1609660800, 46.2], [1609660800, 1609747200, 49.5], [1609747200, 1609833600, 46.9], [1609833600, 1609920000, 42.6], [1609920000, 1610006400, 46.0], [1610006400, 1610092800, 46.7], [1610092800, 1610179200, 44.1], [1610179200, 1610265600, 40.6], [1610265600, 1610352000, 41.5], [1610352000, 1610438400, 41.3], [1610438400, 1610524800, 45.5], [1610524800, 1610611200, 54.5], [1610611200, 1610697600, 49.4], [1610697600, 1610784000, 51.1], [1610784000, 1610870400, 44.1], [1610870400, 1610956800, 53.2], [1610956800, 1611043200, 48.5], [1611043200, 1611129600, null], [1611129600, 1611216000, null], [1611216000, 1611302400, null], [1611302400, 1611388800, null], [1611388800, 1611475200, null], [1611475200, 1611561600, null], [1611561600, 1611648000, null], [1611648000, 1611734400, null], [1611734400, 1611820800, null], [1611820800, 1611907200, null], [1611907200, 1611993600, null], [1611993600, 1612080000, null], [1612080000, 1612166400, null]]
```

The default is to emit the JSON by row. If you want it by column:
```
<pre>
$month.outTemp.series(aggregation_type='max', aggregation_interval='day').json(order_by='column')
</pre>
```
with results:
```
[[1609488000, 1609574400, 1609660800, 1609747200, 1609833600, 1609920000, 1610006400, 1610092800, 1610179200, 1610265600, 1610352000, 1610438400, 1610524800, 1610611200, 1610697600, 1610784000, 1610870400, 1610956800, 1611043200, 1611129600, 1611216000, 1611302400, 1611388800, 1611475200, 1611561600, 1611648000, 1611734400, 1611820800, 1611907200, 1611993600, 1612080000], [1609574400, 1609660800, 1609747200, 1609833600, 1609920000, 1610006400, 1610092800, 1610179200, 1610265600, 1610352000, 1610438400, 1610524800, 1610611200, 1610697600, 1610784000, 1610870400, 1610956800, 1611043200, 1611129600, 1611216000, 1611302400, 1611388800, 1611475200, 1611561600, 1611648000, 1611734400, 1611820800, 1611907200, 1611993600, 1612080000, 1612166400], [45.6, 46.2, 49.5, 46.9, 42.6, 46.0, 46.7, 44.1, 40.6, 41.5, 41.3, 45.5, 54.5, 49.4, 51.1, 44.1, 53.2, 48.5, null, null, null, null, null, null, null, null, null, null, null, null, null]]
```

## Iteration
If you want finer control over formatting, you can iterate over the series and apply precise
formatting. Here's an example:

```
    #set ($start, $stop, $data) = $month.outTemp.series(aggregation_type='max', aggregation_interval='day') ## 1
    <table>
    #for ($time_vh, $data_vh) in $zip($start, $data)                       ## 2
    <tr>
    <td>$time_vh.format("%Y-%m-%d")</td><td>$data_vh.format("%.2f")</td>   ## 3
    </tr>
    #end for
    </table>
```
Here, we create a table. Each row is individually formatted. Comments below refer to the marked
lines:

1. Normally, if the tag `$month.outTemp.series(aggregation_type='max', aggregation_interval='day')`
occurs in a document, Cheetah will try and convert it into a string in order to embed the results
in the generated file. However, if it is not converted into a string, the expression actually
returns a 3-way tuple of `ValueHelpers`. The data in each `ValueHelper` is a series. The first one
holds the start times of the aggregation intervals, the second the stop times, and the third
the actual data. So, in this line, we store the three `ValueHelpers` separately as variables
`$start`, `$stop`, and `$data`, respectively. 

2. We will work only with the start times and data. We
[zip](https://docs.python.org/3/library/functions.html#zip) `$start` and `$data` together in order
to convert the "by column" ordering into "by row", then iterate over the results, assigning
   them to variables `$time_vh` and `$data_vh`. It's important to note, that both of these
   variables are garden-variety `ValueHelpers` and can be formatted accordingly.
   
3. In line 3, we apply some custom formatting. The time is formatted to show only the day. The
datum formatted to show two decimal points.
   
The final results look like:
```
2021-01-01	45.60°F
2021-01-02	46.20°F
2021-01-03	49.50°F
2021-01-04	46.90°F
2021-01-05	42.60°F
...
